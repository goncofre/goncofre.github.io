<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabla de Posiciones de Ligas</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">
    <div class="container mx-auto p-8">
        <h1 class="text-4xl font-bold text-center text-gray-800 mb-8">Tabla de Posiciones de Ligas de Fútbol</h1>

        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Seleccionar Liga</h2>
            <select id="league-select" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-150">
                <option value="" disabled selected>-- Elige una liga --</option>
                <option value="BL1">Bundesliga</option>
                <option value="DED">Eredivisie</option>
                <option value="BSA">Campeonato Brasileiro Série A</option>
                <option value="PD">Primera Division Española</option>
                <option value="FL1">Ligue 1</option>
                <option value="ELC">Championship Inglesa</option>
                <option value="PPL">Primeira Liga Portugal</option>
                <option value="SA">Serie A</option>
                <option value="PL">Premier League</option>
            </select>
        </div>

        <div id="results-container" class="bg-white p-6 rounded-lg shadow-md min-h-[300px] flex items-center justify-center">
            <p class="text-gray-500">Selecciona una liga para ver la tabla de posiciones.</p>
        </div>
        <div id="scores-container" class="bg-white p-6 rounded-lg shadow-md min-h-[300px] flex items-center justify-center">
            <p class="text-gray-500">Selecciona una liga para ver la tabla de goleadores.</p>
        </div>
    </div>

    <script>
        const API_TOKEN = '95411b80d0d54248a859a01061f60d73';
        const leagueSelect = document.getElementById('league-select');
        const resultsContainer = document.getElementById('results-container');
        const scoresContainer = document.getElementById('scores-container');

        // Al cargar la página, revisa si hay una liga en la URL
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const leagueFromUrl = urlParams.get('league') || "PL";

            if (leagueFromUrl) {
                leagueSelect.value = leagueFromUrl;
                loadDataForLeague(leagueFromUrl);
            }
        });

        // Evento para cuando el usuario cambia la selección
        leagueSelect.addEventListener('change', (event) => {
            const selectedLeague = event.target.value;
            if (selectedLeague) {
                loadDataForLeague(selectedLeague);
                // Actualiza la URL en el navegador sin recargar la página
                const url = new URL(window.location);
                url.searchParams.set('league', selectedLeague);
                window.history.pushState({}, '', url);
            }
        });

        function loadDataForLeague(leagueCode) {
            resultsContainer.innerHTML = '<p class="text-gray-500 animate-pulse">Cargando tabla de posiciones...</p>';
            scoresContainer.innerHTML = '<p class="text-gray-500 animate-pulse">Cargando tabla de goleadores...</p>';

            // Se ejecutan ambas peticiones en paralelo
            fetchLeagueData(leagueCode);
            fetchScoreData(leagueCode);
        }

        async function fetchLeagueData(leagueCode) {
            const API_URL = `https://api.football-data.org/v4/competitions/${leagueCode}/standings`;

            try {
                const response = await fetch(API_URL, {
                    headers: { 'X-Auth-Token': API_TOKEN }
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `Error HTTP: ${response.status}`);
                }

                const data = await response.json();
                displayStandings(data);
            } catch (error) {
                console.error('Error al obtener la tabla de posiciones:', error);
                resultsContainer.innerHTML = `<p class="text-red-500">Error al cargar la tabla: ${error.message}</p>`;
            }
        }

        async function fetchScoreData(leagueCode) {
            const API_URL = `https://api.football-data.org/v4/competitions/${leagueCode}/scorers`;

            try {
                const response = await fetch(API_URL, {
                    method: 'GET',
                    headers: {
                        'X-Auth-Token': API_TOKEN
                    }
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `Error HTTP: ${response.status}`);
                }

                const data = await response.json();
                displayScore(data);
            } catch (error) {
                console.error('Error al obtener la tabla de goleadores:', error);
                scoresContainer.innerHTML = `<p class="text-red-500">Error al cargar goleadores: ${error.message}</p>`;
            }
        }

        function displayStandings(data) {
            resultsContainer.innerHTML = '';

            if (data.standings && data.standings.length > 0) {
                const standings = data.standings[0].table;

                let tableHtml = `<table class="min-w-full bg-white border border-gray-200">`;
                tableHtml += `<thead><tr class="bg-gray-100 text-gray-600 uppercase text-sm leading-normal">`;
                tableHtml += `<th class="py-3 px-6 text-left">Pos</th>`;
                tableHtml += `<th class="py-3 px-6 text-left">Equipo</th>`;
                tableHtml += `<th class="py-3 px-6 text-left">PJ</th>`;
                tableHtml += `<th class="py-3 px-6 text-left">G</th>`;
                tableHtml += `<th class="py-3 px-6 text-left">E</th>`;
                tableHtml += `<th class="py-3 px-6 text-left">P</th>`;
                tableHtml += `<th class="py-3 px-6 text-left">GF</th>`;
                tableHtml += `<th class="py-3 px-6 text-left">GC</th>`;
                tableHtml += `<th class="py-3 px-6 text-left">Dif</th>`;
                tableHtml += `<th class="py-3 px-6 text-left">Pts</th>`;
                tableHtml += `</tr></thead><tbody class="text-gray-600 text-sm font-light">`;

                standings.forEach(team => {
                    tableHtml += `<tr class="border-b border-gray-200 hover:bg-gray-100">`;
                    tableHtml += `<td class="py-3 px-6 text-left whitespace-nowrap">${team.position}</td>`;
                    tableHtml += `<td class="py-3 px-6 text-left flex items-center"><img src="${team.team.crest}" alt="${team.team.name}" class="w-6 h-6 mr-2 rounded-full object-cover"> <a href="equipo.html?id=${team.team.id}" class="text-blue-500 hover:underline"> ${team.team.name} </a></td>`;
                    tableHtml += `<td class="py-3 px-6 text-left">${team.playedGames}</td>`;
                    tableHtml += `<td class="py-3 px-6 text-left">${team.won}</td>`;
                    tableHtml += `<td class="py-3 px-6 text-left">${team.draw}</td>`;
                    tableHtml += `<td class="py-3 px-6 text-left">${team.lost}</td>`;
                    tableHtml += `<td class="py-3 px-6 text-left">${team.goalsFor}</td>`;
                    tableHtml += `<td class="py-3 px-6 text-left">${team.goalsAgainst}</td>`;
                    tableHtml += `<td class="py-3 px-6 text-left">${team.goalDifference}</td>`;
                    tableHtml += `<td class="py-3 px-6 text-left font-bold">${team.points}</td>`;
                    tableHtml += `</tr>`;
                });

                tableHtml += `</tbody></table>`;
                resultsContainer.innerHTML = tableHtml;

            } else {
                resultsContainer.innerHTML = `<p class="text-gray-500">No se encontraron datos para la liga seleccionada.</p>`;
            }
        }

         function displayScore(data) {
            scoresContainer.innerHTML = '';

            if (data.scorers && data.scorers.length > 0) {
                const scorers = data.scorers;

                let tableHtml = `<table class="min-w-full bg-white border border-gray-200">`;
                tableHtml += `<thead><tr class="bg-gray-100 text-gray-600 uppercase text-sm leading-normal">`;
                tableHtml += `<th class="py-3 px-6 text-left">Jugador</th>`;
                tableHtml += `<th class="py-3 px-6 text-left">Equipo</th>`;
                tableHtml += `<th class="py-3 px-6 text-left">Goles</th>`;
                tableHtml += `</tr></thead><tbody class="text-gray-600 text-sm font-light">`;

                scorers.forEach(scorer => {
                    tableHtml += `<tr class="border-b border-gray-200 hover:bg-gray-100">`;
                    tableHtml += `<td class="py-3 px-6 text-left"><a href="jugador.html?id=${scorer.player.id}" class="text-blue-500 hover:underline">${scorer.player.name}</a></td>`;
                    tableHtml += `<td class="py-3 px-6 text-left">${scorer.team.name}</td>`;
                    tableHtml += `<td class="py-3 px-6 text-left font-semibold">${scorer.goals}</td>`;
                    tableHtml += `</tr>`;
                });

                scoresContainer.innerHTML = tableHtml;
            } else {
                scoresContainer.innerHTML = `<p class="text-gray-500">No se encontraron datos para la liga seleccionada.</p>`;
            }
        }
    </script>
</body>
</html>